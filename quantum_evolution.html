<!DOCTYPE html>
<html lang="zh-TW">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÈáèÂ≠êÈÄ≤Âåñ (Quantum Evolution)</title>
    <style>
        :root {
            --bg-dark: #1a1a2e;
            --bg-panel: #16213e;
            --primary: #0f3460;
            --accent: #e94560;
            --text-main: #e0e0e0;
            --text-muted: #8d99ae;
            --border: #2a2a40;
            --highlight: #4ecca3;
        }

        * {
            box-sizing: border-box;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: 'Courier New', Courier, monospace;
            /* Èß≠ÂÆ¢È¢®Ê†ºÂ≠óÈ´î */
            background-color: var(--bg-dark);
            color: var(--text-main);
            margin: 0;
            padding: 0;
            height: 100vh;
            display: flex;
            overflow: hidden;
        }

        /* Â∑¶ÂÅ¥ÔºöÊ†∏ÂøÉ‰∫íÂãïÂçÄ */
        .panel-main {
            flex: 1;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            border-right: 1px solid var(--border);
            position: relative;
            background: radial-gradient(circle at center, #1f2f50 0%, var(--bg-dark) 70%);
        }

        .currency-display {
            text-align: center;
            margin-bottom: 40px;
        }

        .currency-amount {
            font-size: 3rem;
            font-weight: bold;
            color: var(--highlight);
            text-shadow: 0 0 10px rgba(78, 204, 163, 0.5);
        }

        .currency-rate {
            font-size: 1rem;
            color: var(--text-muted);
            margin-top: 5px;
        }

        .main-btn {
            width: 180px;
            height: 180px;
            border-radius: 50%;
            background: linear-gradient(145deg, #1a2644, #0d1324);
            border: 4px solid var(--accent);
            box-shadow: 0 0 20px rgba(233, 69, 96, 0.2);
            cursor: pointer;
            transition: all 0.1s;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: hidden;
        }

        .main-btn:active {
            transform: scale(0.95);
            box-shadow: 0 0 10px rgba(233, 69, 96, 0.5);
        }

        .main-btn::after {
            content: 'ENTROPY';
            font-weight: bold;
            letter-spacing: 2px;
            color: var(--accent);
        }

        /* ÈªûÊìäÁâπÊïà */
        .floating-text {
            position: absolute;
            color: white;
            font-weight: bold;
            pointer-events: none;
            animation: floatUp 1s ease-out forwards;
        }

        @keyframes floatUp {
            0% {
                opacity: 1;
                transform: translateY(0);
            }

            100% {
                opacity: 0;
                transform: translateY(-50px);
            }
        }

        /* Âè≥ÂÅ¥ÔºöÂçáÁ¥öËàáÂª∫ÁØâ */
        .panel-upgrades {
            flex: 1.2;
            background-color: var(--bg-panel);
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .tabs {
            display: flex;
            border-bottom: 1px solid var(--border);
        }

        .tab-btn {
            flex: 1;
            padding: 15px;
            background: transparent;
            border: none;
            color: var(--text-muted);
            font-family: inherit;
            font-weight: bold;
            cursor: pointer;
            transition: 0.2s;
        }

        .tab-btn.active {
            background-color: #1f2f4f;
            color: var(--text-main);
            border-bottom: 3px solid var(--accent);
        }

        .scroll-area {
            flex: 1;
            overflow-y: auto;
            padding: 10px;
        }

        /* Âª∫ÁØâÈ†ÖÁõÆ */
        .item-card {
            background-color: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--border);
            margin-bottom: 8px;
            padding: 12px;
            border-radius: 6px;
            display: flex;
            align-items: center;
            cursor: pointer;
            transition: 0.2s;
            position: relative;
            overflow: hidden;
        }

        .item-card:hover {
            background-color: rgba(255, 255, 255, 0.08);
            transform: translateX(5px);
        }

        .item-card.disabled {
            opacity: 0.5;
            cursor: not-allowed;
            filter: grayscale(0.8);
        }

        .item-card.disabled:hover {
            transform: none;
        }

        .item-icon {
            font-size: 2rem;
            margin-right: 15px;
            width: 40px;
            text-align: center;
        }

        .item-info {
            flex: 1;
        }

        .item-name {
            font-weight: bold;
            font-size: 1rem;
            color: var(--highlight);
        }

        .item-cost {
            font-size: 0.8rem;
            color: var(--accent);
        }

        .item-production {
            font-size: 0.75rem;
            color: var(--text-muted);
        }

        .item-count {
            font-size: 1.5rem;
            font-weight: bold;
            color: rgba(255, 255, 255, 0.1);
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
        }

        /* Èõ¢Á∑öÊî∂Áõä Modal */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.85);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 100;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s;
        }

        .modal.active {
            opacity: 1;
            pointer-events: auto;
        }

        .modal-box {
            background: var(--bg-panel);
            border: 2px solid var(--accent);
            padding: 30px;
            border-radius: 10px;
            text-align: center;
            max-width: 400px;
            width: 80%;
        }

        .welcome-back-title {
            font-size: 1.5rem;
            color: var(--highlight);
            margin-bottom: 15px;
        }

        .offline-gain {
            font-size: 2rem;
            color: white;
            margin: 20px 0;
        }

        .btn-confirm {
            background: var(--accent);
            color: white;
            border: none;
            padding: 10px 30px;
            border-radius: 5px;
            font-size: 1.2rem;
            cursor: pointer;
        }

        /* Ë®≠ÂÆöÂçÄÂ°ä */
        .settings-area {
            position: absolute;
            bottom: 10px;
            left: 10px;
            font-size: 0.8rem;
            color: var(--text-muted);
        }

        .reset-btn {
            background: none;
            border: 1px solid var(--danger);
            color: #e74c3c;
            padding: 2px 5px;
            cursor: pointer;
            margin-left: 10px;
        }

        /* RWD */
        @media (max-width: 768px) {
            body {
                flex-direction: column;
            }

            .panel-main {
                flex: 0.8;
                padding: 10px;
                border-right: none;
                border-bottom: 1px solid var(--border);
            }

            .main-btn {
                width: 140px;
                height: 140px;
            }

            .currency-amount {
                font-size: 2.5rem;
            }
        }
    </style>
</head>

<body>

    <!-- Â∑¶ÂÅ¥Èù¢Êùø -->
    <div class="panel-main">
        <div class="currency-display">
            <div class="currency-amount" id="entropy-display">0</div>
            <div class="currency-rate" id="rate-display">0 entropy / sec</div>
        </div>

        <button class="main-btn" id="click-btn" onclick="game.click()"></button>

        <div class="settings-area">
            <span id="save-status">Auto-saved</span>
            <button class="reset-btn" onclick="game.hardReset()">Reset Save</button>
        </div>
    </div>

    <!-- Âè≥ÂÅ¥Èù¢Êùø -->
    <div class="panel-upgrades">
        <div class="tabs">
            <button class="tab-btn active" onclick="ui.switchTab('generators')">Generators</button>
            <button class="tab-btn" onclick="ui.switchTab('upgrades')">Upgrades</button>
        </div>

        <div class="scroll-area" id="list-container">
            <!-- ÂãïÊÖãÁîüÊàêÂÖßÂÆπ -->
        </div>
    </div>

    <!-- Èõ¢Á∑öÊî∂ÁõäË¶ñÁ™ó -->
    <div class="modal" id="offline-modal">
        <div class="modal-box">
            <div class="welcome-back-title">SYSTEM REBOOTED</div>
            <div>While you were offline, your simulation generated:</div>
            <div class="offline-gain" id="offline-val">0</div>
            <div>Entropy</div>
            <button class="btn-confirm"
                onclick="document.getElementById('offline-modal').classList.remove('active')">ACKNOWLEDGE</button>
        </div>
    </div>

    <script>
        /**
         * Quantum Evolution - Core Logic
         * ÂåÖÂê´Â§ßÊï∏ËôïÁêÜ„ÄÅÈÅäÊà≤Âæ™Áí∞„ÄÅÂ≠òÊ™îÊ©üÂà∂
         */

        // Â∑•ÂÖ∑ÔºöÊï∏ÂÄºÊ†ºÂºèÂåñ (1.2k, 1.5M, 3.4B)
        const formatNumber = (num) => {
            if (num < 1000) return Math.floor(num);
            const suffixes = ["", "k", "M", "B", "T", "Qa", "Qi", "Sx", "Sp", "Oc"];
            const suffixNum = Math.floor(("" + Math.floor(num)).length / 3);
            if (suffixNum >= suffixes.length) return num.toExponential(2); // Ë∂ÖÂ§ßÊï∏Áî®ÁßëÂ≠∏Ë®òËôü

            let shortValue = parseFloat((suffixNum !== 0 ? (num / Math.pow(1000, suffixNum)) : num).toPrecision(3));
            if (shortValue % 1 !== 0) {
                shortValue = shortValue.toFixed(1);
            }
            return shortValue + suffixes[suffixNum];
        };

        // ÈÅäÊà≤Ë®≠ÂÆöËàáË≥áÊñô
        const GameData = {
            generators: [
                { id: 'g1', name: 'Abacus', baseCost: 15, baseProd: 0.5, icon: 'üßÆ', desc: 'Ancient calculation.' },
                { id: 'g2', name: 'Calculator', baseCost: 100, baseProd: 3, icon: 'üìü', desc: 'Solar powered.' },
                { id: 'g3', name: 'Server Rack', baseCost: 1100, baseProd: 12, icon: 'üíæ', desc: 'Noisy and hot.' },
                { id: 'g4', name: 'Quantum Rig', baseCost: 12000, baseProd: 50, icon: '‚öõÔ∏è', desc: 'Entangled bits.' },
                { id: 'g5', name: 'AI Core', baseCost: 130000, baseProd: 250, icon: 'üß†', desc: 'Sentient logic.' },
                { id: 'g6', name: 'Dyson Sphere', baseCost: 1400000, baseProd: 1500, icon: '‚òÄÔ∏è', desc: 'Stellar energy.' }
            ],
            upgrades: [
                { id: 'u1', name: 'Steady Fingers', cost: 500, type: 'click', mult: 2, icon: 'üëÜ', desc: 'Click power x2' },
                { id: 'u2', name: 'Lubricant', cost: 1000, type: 'gen', genId: 'g1', mult: 2, icon: 'üõ¢Ô∏è', desc: 'Abacus efficiency x2' },
                { id: 'u3', name: 'Overclocking', cost: 5000, type: 'gen', genId: 'g2', mult: 2, icon: '‚ö°', desc: 'Calculator efficiency x2' },
                { id: 'u4', name: 'Liquid Cooling', cost: 25000, type: 'gen', genId: 'g3', mult: 2, icon: '‚ùÑÔ∏è', desc: 'Server Rack efficiency x2' },
                { id: 'u5', name: 'Neural Link', cost: 100000, type: 'click', mult: 5, icon: 'üîó', desc: 'Click power x5' }
            ]
        };

        class GameEngine {
            constructor() {
                this.state = {
                    entropy: 0,
                    totalEntropy: 0,
                    startTime: Date.now(),
                    lastSaveTime: Date.now(),
                    buildings: {}, // { g1: 5, g2: 1 ... }
                    upgrades: [],  // ['u1', 'u3']
                };

                // ÂàùÂßãÂåñÂª∫ÁØâÊï∏Èáè
                GameData.generators.forEach(g => this.state.buildings[g.id] = 0);

                this.mps = 0; // per second
                this.clickPower = 1;
                this.loadGame();
                this.loopId = null;
                this.lastTick = Date.now();
            }

            // Ë®àÁÆóÁõÆÂâçÊØèÁßíÁî¢Âá∫ (Money Per Second)
            recalcMPS() {
                let prod = 0;
                GameData.generators.forEach(g => {
                    let count = this.state.buildings[g.id];
                    if (count > 0) {
                        let multiplier = 1;
                        // Ê™¢Êü•Áõ∏ÈóúÂçáÁ¥ö
                        this.state.upgrades.forEach(uid => {
                            const u = GameData.upgrades.find(x => x.id === uid);
                            if (u && u.type === 'gen' && u.genId === g.id) multiplier *= u.mult;
                        });
                        prod += (g.baseProd * count * multiplier);
                    }
                });
                this.mps = prod;

                // Ë®àÁÆóÈªûÊìäÂäõ
                let clickMult = 1;
                this.state.upgrades.forEach(uid => {
                    const u = GameData.upgrades.find(x => x.id === uid);
                    if (u && u.type === 'click') clickMult *= u.mult;
                });
                this.clickPower = 1 * clickMult + (this.mps * 0.05); // ÈªûÊìäÂäõÈö® MPS ÊàêÈï∑‰∏ÄÈªûÈªû
            }

            // Áç≤ÂèñÂª∫ÁØâÊàêÊú¨ (ÊåáÊï∏ÊàêÈï∑ 1.15ÂÄç)
            getCost(genId) {
                const g = GameData.generators.find(x => x.id === genId);
                const count = this.state.buildings[genId];
                return Math.floor(g.baseCost * Math.pow(1.15, count));
            }

            click() {
                this.addEntropy(this.clickPower);
                ui.createFloatingText(this.clickPower);
            }

            buyGenerator(id) {
                const cost = this.getCost(id);
                if (this.state.entropy >= cost) {
                    this.state.entropy -= cost;
                    this.state.buildings[id]++;
                    this.recalcMPS();
                    ui.update();
                    this.saveGame(); // ÈáçË¶ÅÊìç‰ΩúÂæåÁ´ãÂç≥Â≠òÊ™î
                }
            }

            buyUpgrade(id) {
                const u = GameData.upgrades.find(x => x.id === id);
                if (!this.state.upgrades.includes(id) && this.state.entropy >= u.cost) {
                    this.state.entropy -= u.cost;
                    this.state.upgrades.push(id);
                    this.recalcMPS();
                    ui.update(); // ÈúÄË¶ÅÈáçÁπ™ÂàóË°®ÁßªÈô§Â∑≤Ë≤∑ÁöÑ
                    this.saveGame();
                }
            }

            addEntropy(amount) {
                this.state.entropy += amount;
                this.state.totalEntropy += amount;
                ui.updateDisplay();
            }

            // ‰∏ªÂæ™Áí∞
            startLoop() {
                const tick = () => {
                    const now = Date.now();
                    const dt = (now - this.lastTick) / 1000; // delta time in seconds

                    if (this.mps > 0) {
                        this.addEntropy(this.mps * dt);
                    }

                    this.lastTick = now;

                    // ÊØè 10 ÁßíËá™ÂãïÂ≠òÊ™î
                    if (now - this.state.lastSaveTime > 10000) {
                        this.saveGame();
                    }

                    this.loopId = requestAnimationFrame(tick);
                };
                this.loopId = requestAnimationFrame(tick);
            }

            saveGame() {
                this.state.lastSaveTime = Date.now();
                localStorage.setItem('quantum_save_v1', JSON.stringify(this.state));
                const status = document.getElementById('save-status');
                status.style.opacity = 1;
                setTimeout(() => status.style.opacity = 0.5, 1000);
            }

            loadGame() {
                const save = localStorage.getItem('quantum_save_v1');
                if (save) {
                    try {
                        const savedState = JSON.parse(save);
                        // Âêà‰ΩµÂ≠òÊ™îËàáÈ†êË®≠ÂÄº (Èò≤Ê≠¢ÁâàÊú¨Êõ¥Êñ∞ÂæåÁº∫Â∞ëÊ¨Ñ‰Ωç)
                        this.state = { ...this.state, ...savedState };

                        // Ë®àÁÆóÈõ¢Á∑öÊî∂Áõä
                        const now = Date.now();
                        const secondsOffline = (now - this.state.lastSaveTime) / 1000;

                        // ÂÖàË®àÁÆó MPS
                        this.recalcMPS();

                        if (secondsOffline > 60 && this.mps > 0) {
                            const gain = this.mps * secondsOffline * 0.5; // Èõ¢Á∑öÂè™Êúâ 50% ÊïàÁéá
                            this.state.entropy += gain;
                            ui.showOfflineModal(formatNumber(gain));
                        }

                    } catch (e) {
                        console.error("Save file corrupted", e);
                    }
                }
                this.recalcMPS();
            }

            hardReset() {
                if (confirm("Are you sure you want to wipe your save? This cannot be undone.")) {
                    localStorage.removeItem('quantum_save_v1');
                    location.reload();
                }
            }
        }

        class UI {
            constructor() {
                this.currentTab = 'generators';
                this.container = document.getElementById('list-container');
            }

            switchTab(tab) {
                this.currentTab = tab;
                document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
                // ÈÄôË£°Á∞°ÂåñËôïÁêÜÔºåÁõ¥Êé•Áî® onclick Ëß∏ÁôºÁöÑ button ÊñáÂ≠óÂà§Êñ∑ÂèØËÉΩÊúâË™§ÔºåÊúÄÂ•ΩÁî® ID
                // ÈÄôË£°ÂÅáË®≠Âè™ÊúâÂÖ©ÂÄãÊåâÈàïÔºåÁ∞°ÂñÆÂàáÊèõ active class
                if (tab === 'generators') document.querySelector('.tabs button:first-child').classList.add('active');
                else document.querySelector('.tabs button:last-child').classList.add('active');

                this.renderList();
            }

            createFloatingText(amount) {
                const btn = document.getElementById('click-btn');
                const rect = btn.getBoundingClientRect();
                const el = document.createElement('div');
                el.className = 'floating-text';
                el.textContent = "+" + formatNumber(amount);

                // Èö®Ê©ü‰ΩçÁΩÆ
                const x = rect.left + rect.width / 2 + (Math.random() * 60 - 30);
                const y = rect.top + rect.height / 2 + (Math.random() * 60 - 30);

                el.style.left = x + 'px';
                el.style.top = y + 'px';

                document.body.appendChild(el);
                setTimeout(() => el.remove(), 1000);
            }

            showOfflineModal(val) {
                document.getElementById('offline-val').textContent = val;
                document.getElementById('offline-modal').classList.add('active');
            }

            updateDisplay() {
                document.getElementById('entropy-display').textContent = formatNumber(game.state.entropy);
                document.getElementById('rate-display').textContent = `${formatNumber(game.mps)} entropy / sec`;

                // Ê™¢Êü•ÊåâÈàïÊòØÂê¶Ë©≤ disable
                this.updateButtonStates();
            }

            updateButtonStates() {
                const items = document.querySelectorAll('.item-card');
                items.forEach(el => {
                    const cost = parseFloat(el.dataset.cost);
                    if (game.state.entropy >= cost) {
                        el.classList.remove('disabled');
                    } else {
                        el.classList.add('disabled');
                    }
                });
            }

            // ÂÆåÊï¥ÈáçÁπ™ÂàóË°® (ÂàáÊèõ Tab ÊàñË≤∑ÊéâÂçáÁ¥öÊôÇË™øÁî®)
            renderList() {
                this.container.innerHTML = '';

                if (this.currentTab === 'generators') {
                    GameData.generators.forEach(g => {
                        const cost = game.getCost(g.id);
                        const count = game.state.buildings[g.id];

                        const div = document.createElement('div');
                        div.className = 'item-card ' + (game.state.entropy >= cost ? '' : 'disabled');
                        div.dataset.cost = cost;
                        div.dataset.id = g.id;
                        div.onclick = () => game.buyGenerator(g.id);

                        div.innerHTML = `
                    <div class="item-icon">${g.icon}</div>
                    <div class="item-info">
                        <div class="item-name">${g.name}</div>
                        <div class="item-production">+${g.baseProd} / sec</div>
                        <div class="item-cost">Cost: ${formatNumber(cost)}</div>
                    </div>
                    <div class="item-count">${count}</div>
                `;
                        this.container.appendChild(div);
                    });
                } else {
                    // Upgrades
                    GameData.upgrades.forEach(u => {
                        // Â¶ÇÊûúÂ∑≤Á∂ìË≤∑ÈÅéÂ∞±‰∏çÈ°ØÁ§∫
                        if (game.state.upgrades.includes(u.id)) return;

                        // ÂèØÈÅ∏ÔºöÂ¶ÇÊûúÈÇÑÊ≤íËß£ÈéñÔºàÈå¢Â§™Â∞ëÊàñÂâçÁΩÆÊ¢ù‰ª∂Êú™ÈÅîÔºâ‰πüÂèØ‰ª•Èö±ËóèÔºåÈÄôË£°ÂÖàÂÖ®ÈÉ®È°ØÁ§∫

                        const div = document.createElement('div');
                        div.className = 'item-card ' + (game.state.entropy >= u.cost ? '' : 'disabled');
                        div.dataset.cost = u.cost;
                        div.onclick = () => game.buyUpgrade(u.id);

                        div.innerHTML = `
                    <div class="item-icon">${u.icon}</div>
                    <div class="item-info">
                        <div class="item-name">${u.name}</div>
                        <div class="item-production">${u.desc}</div>
                        <div class="item-cost">Cost: ${formatNumber(u.cost)}</div>
                    </div>
                `;
                        this.container.appendChild(div);
                    });

                    if (this.container.children.length === 0) {
                        this.container.innerHTML = '<div style="text-align:center; color:#666; padding:20px;">All upgrades purchased!</div>';
                    }
                }
            }

            // ÊØèÂπÄÊõ¥Êñ∞ (Âè™Êõ¥Êñ∞Êï∏Â≠óÔºå‰∏çÈáçÁπ™ DOM ÁµêÊßã‰ª•ÁØÄÁúÅÊïàËÉΩ)
            update() {
                this.renderList(); // Á∞°ÂñÆËµ∑Ë¶ãÁõ¥Êé•ÈáçÁπ™ÔºåÂÑ™ÂåñÁâàÊáâË©≤Âè™Êîπ innerText
                this.updateDisplay();
            }
        }

        // ÂïüÂãï
        const game = new GameEngine();
        const ui = new UI();

        // ÂàùÂßãÂåñÊ∏≤Êüì
        ui.renderList();
        ui.updateDisplay();
        game.startLoop();

        // ÊØèÁßíÂà∑Êñ∞‰∏ÄÊ¨° UI ÂàóË°®ÁöÑÂÉπÊ†ºÈ°èËâ≤ÁãÄÊÖãÔºå‰∏çÈúÄË¶ÅÊØèÂπÄÂà∑
        setInterval(() => ui.updateButtonStates(), 100);

    </script>
</body>

</html>